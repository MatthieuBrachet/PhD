% testSWEC.tex
\chapter{Benchmarks sur l'équation SWEC}

\section{Forme de SWEC}

On a montré dans le Chapitre 1 que l'équation Shallow Water était issue de l'équation de Navier-Stokes en tenant compte d'une faible profondeur de fluide et de la faible viscosité.

L'équation Shallow Water obtenue était la suivante :

\begin{equation}
\label{SWEC_new}
\left\lbrace
\begin{array}{rcl}
\dfrac{\partial \mathbf{u}}{\partial t} + \left( \mathbf{u} \cdot \nabla \right) \mathbf{u} + f \mathbf{k} \wedge \mathbf{u} + g \nabla \eta & = & \mathbf{0} \\
\dfrac{\partial \eta^{\star}}{\partial t} + \nabla \cdot \left( \eta^{\star} \mathbf{u} \right) & = & 0
\end{array}
\right.
\end{equation}

avec $\eta^{\star} = \eta - \eta_s$, $\eta_s$ représentant les reliefs sur la sphère. On suppose $\eta_s$ indépendant du temps $t$.

Il peut être délicat de travailler directement avec le terme $\left( \mathbf{u} \cdot \nabla \right) \mathbf{u}$. Pour éviter de discrétiser directement ce terme, on se repose sur la formule suivante :

\begin{equation}
\left( \mathbf{u} \cdot \nabla \right) \mathbf{u} = \nabla \left( \dfrac{1}{2} \mathbf{u}^2 \right) + \zeta \mathbf{k} \wedge \mathbf{u}
\end{equation}

avec $\zeta = \mathbf{k} \cdot \left( \nabla \wedge \mathbf{u} \right)$ la vorticité relative. On note la présence de $\nabla \wedge \mathbf{u}$ le rotationnel de $\mathbf{u}$.

L'équation \eqref{SWEC_new} s'écrit alors :

\begin{equation}
\label{SWEC_vectform}
\left\lbrace
\begin{array}{rcl}
\dfrac{\partial \mathbf{u}}{\partial t} + \nabla \left( g \eta + \dfrac{1}{2} \mathbf{u}^2  \right) + \left( \zeta + f \right) \mathbf{k} \wedge \mathbf{u} & = & \mathbf{0} \\
\dfrac{\partial \eta^{\star}}{\partial t} + \nabla \cdot \left( \eta^{\star} \mathbf{u} \right) & = & 0
\end{array}
\right.
\end{equation}

Dans la suite, nous travaillerons avec cette forme de l'équation \eqref{SWEC_new}.


\section{Relations de Conservations}

L'équation \eqref{SWEC_vectform} vérifie certaines relations de conservations au sens continu.

\begin{proposition}
Les relations de conservations suivantes sont vérifiées si $(\mathbf{u},h)$ est solution de \eqref{SWEC_vectform} :
\begin{itemize}
\item Conservation de la matière :
\begin{equation}
\dfrac{d}{dt} \gint_{\mathbb{S}_a^2} h^{\star} = 0
\label{eq:mass}
\end{equation}
 
\item Conservation de l'énergie :
\begin{equation}
\dfrac{d}{dt} \gint_{\mathbb{S}_a^2} \dfrac{1}{2} h^{\star} \mathbf{u}.^2 + \dfrac{1}{2} g \left( h^2 - h_s^2 \right) = 0
\label{eq:energy}
\end{equation}

\item Conservation de l'enstrophie potentielle :
\begin{equation}
\dfrac{d}{dt} \gint_{\mathbb{S}_a^2} \dfrac{\left( \zeta + f \right)^2}{h^{\star}} = 0
\label{eq:enstrophie}
\end{equation}

\item Conservation de la vorticité :
\begin{equation}
\dfrac{d}{dt} \gint_{\mathbb{S}_a^2} \zeta = 0
\label{eq:vorticity}
\end{equation}

\item Conservation de la divergence
\begin{equation}
\dfrac{d}{dt} \gint_{\mathbb{S}_a^2} \nabla \cdot \mathbf{u} = 0
\label{eq:divergence}
\end{equation}
\end{itemize}

avec $\zeta = \left( \nabla \wedge \mathbf{u} \right) \cdot \mathbf{k}$.
\end{proposition}

\begin{remarque}
Pour prouver que $\delta$ est conservée, il suffit de montrer qu'il existe $\mathbf{F}$ tel que :
$$
\dfrac{\partial \delta}{\partial t} = \nabla \cdot \mathbf{F}
$$
puis d'intégrer et de conclure avec la remarque \ref{remark_stokes}.
\label{rmq:int diverg nulle}
\end{remarque}

\begin{proof}
Pour la conservation de la masse \eqref{eq:mass} et de la divergence \eqref{eq:divergence}, le résultat est immédiat.

De plus, en posant $q = \dfrac{\zeta+f}{h^{\star}}$ et en appliquant à \eqref{SWEC_vectform} l'opérateur de vorticité "$\mathbf{k} \cdot \left( \nabla \wedge \cdot \right)$", on obtient :

$$
\dfrac{\partial \zeta}{\partial t}+\nabla \wedge \left( q h^{\star} \mathbf{k} \wedge \mathbf{u} \right) \cdot\mathbf{k} + \underbrace{\nabla \wedge \nabla \left( gh + \dfrac{1}{2}\mathbf{u}^2 \right) \cdot \mathbf{k}}_{=0} = 0 
$$

Or on sait que pour tout $\mathbf{X}$ et $\mathbf{F}$, on a :
\begin{equation}
\nabla \cdot \left( \mathbf{X} \wedge \mathbf{F} \right) = - \left( \nabla \wedge \mathbf{F} \right) \cdot \mathbf{X}.
\end{equation}

donc :

$$
\dfrac{ \partial \zeta}{\partial t} + \nabla \cdot \left( q h^{\star} \mathbf{u} \right) = 0
$$

En utilisant la remarque \ref{rmq:int diverg nulle}, on en déduit la conservation de la vorticité \eqref{eq:vorticity}.

On note, que $f$ est indépendant du temps : $\dfrac{\partial q h^{\star}}{\partial t
} = \dfrac{\partial \zeta}{\partial t}$.

$$
\dfrac{\partial}{\partial t} \left( q h^{\star} \right) + \nabla \cdot \left( q h^{\star} \mathbf{u} \right) = 0
$$

et on a démontré la conservation de l'enstrophie potentielle \eqref{eq:enstrophie}.

En ce qui conserne la conservation de l'énergie, on pose :
\begin{equation}
\begin{array}{rcl}
E_1 & = & \dfrac{1}{2} h^{\star} \mathbf{u}^2 \\
E_2 & = & \dfrac{1}{2} g \left( h^2 - h_s^2 \right)
\end{array}
\end{equation}

par dérivation :
\begin{equation}
\begin{array}{rcl}
\dfrac{\partial}{\partial t} E_1 & = & -\dfrac{1}{2} \mathbf{u}^2 \nabla \cdot \left( h^{\star} \mathbf{u} \right) - h^{\star} \mathbf{u} \cdot \nabla \left( \dfrac{1}{2} \mathbf{u}^2 + gh \right) \\
\dfrac{\partial}{\partial t} E_2 & = & - gh \nabla \cdot \left( h^{\star} \mathbf{u} \right) - g h_s \dfrac{\partial h_s}{\partial t} 
\end{array}
\end{equation}

par somme :

$$
\dfrac{\partial E_1 + E_2}{\partial t} = - \nabla \cdot \left( \dfrac{1}{2} \mathbf{u}^2 + gh \right) - g h_s \dfrac{\partial h_s}{\partial t} 
$$

$h_s$ est indépendant du temps donc en appliquant la remarque \ref{rmq:int diverg nulle}, on obtient la conservation de l'énergie.
\end{proof}

\section{Solution stationnaire zonale}

Dans cette partie, on se cherche $(\mathbf{u}, \eta)$ une solution zonale stationnaire de \eqref{SWEC_new}.

On considère $\mathbf{u}$ sous la forme :

\begin{equation}
\mathbf{u}(\theta) = u(\theta) \mathbf{e}_{\lambda}
\end{equation}

et on cherche la fonction $\eta$ associée.

En écrivant \eqref{SWEC_new} dans le système de coordonnées $(\lambda, \theta)$ et en considèrant que $\mathbf{u}$ indépendant de $\lambda$, comme $(\mathbf{u}, \eta)$ est une solution stationnaire :



\section{Test 2 de D. L. Williamson \textit{et al.} : Etat d'équilibre zonal}

Le second test de D. L. Williamson \textit{et al.} \cite{Williamson1992} est un test visant à observer la conservation d'une solution stationnaire et zonale pour un schéma numérique. On cherche à observer les conservations d'énergie, de masse et d'enstropie potentielle.

Ce test reposant sur une solution stationnaire, la solution exacte est conne à chaque instant. Le champ de vitesse $\mathbf{u} = u \mathbf{e}_{\lambda} + v \mathbf{e}_{\theta}$ est donné par :

\begin{equation}
\left\lbrace
\begin{array}{rcl}
u & = & u_0 \left( cos \theta cos \alpha + cos \lambda sin \theta sin \alpha \right)\\
v & = & - u_0 sin \lambda sin \alpha
\end{array}
\right.
\label{eq:williamson2_u}
\end{equation}

où $u_0 = 2 \pi 0 / (12 \text{jours} )$ et $\alpha$ est l'angle d'inclinaisonde  la sphère.

La hauteur du fluide s'obtient en consèquences comme étant :

\begin{equation}
\eta = \eta_0 - \left( a \omega u_0 + \dfrac{1}{2}u_0^2 \right) \left( -cos \lambda cos \theta sin \alpha + sin \theta cos \alpha \right)^2
\label{eq:williamson2_h}
\end{equation}

$\eta_0$ est tel que $g \eta_0 = 2.94 \times 10^{-4}$. 

Le terme de la force de Coriolis $f$ est adapté à l'inclinaison de l'axe Nord-Sud d'un angle $\alpha$. Ainsi on a :

$$ f = 2 \omega sin \theta' = 2 \omega \left( -cos \lambda cos \theta sin \alpha + sin \theta cos \alpha \right)$$





\section{Test 5 de D. L. Williamson \textit{et al.} : flux zonal autour d'une montagne isolée}

Pour ce test, issu de \cite{Williamson1992}, aucune solution analyique n'est connue. On compare les résultats à différents temps et on observe les relations de conservations souhaitées.

Le champ de vitesse itinial $\mathbf{u}$ est donnée par \eqref{eq:williamson2_u} avec $\alpha=0$ et la hauteur d'atmosphère $\eta$ par \eqref{eq:williamson2_h}. En revanche, contrairement au test précédent, on choisit $u_0=20m/s$.
Cette condition initiale stationnaire est perturbée par l'ajout de reliefs. On considère $\eta_s$ les reliefs de la sphère donnés par :

\begin{equation}
\eta_s = \eta_{s_0} \left( 1 - \dfrac{r}{R} \right)
\end{equation}

avec $\eta_{s_0}=5960m$, $R=\pi/9$ et $r = \sqrt{min\left( R^2, \left( \lambda-\lambda_c \right)^2 + \left( \theta-\theta_c \right)^2 \right)}$.
Le centre de la montagne est positionné en $(\lambda_c, \theta_c) = (3\pi/2, \pi/6)$.

On observe la solution à $5$ , $10$ et $15$ jours en Figure \ref{Williamson 5 - visuel}. Les relations de conservations sont aussi données par : \ref{Williamson 5 - conservation}

\begin{figure}
\begin{center}
\includegraphics[scale=0.4]{ref_7366847796_snapshot_intermediaire499.png}\\
\includegraphics[scale=0.4]{ref_7366847796_snapshot_intermediaire999.png}\\
\includegraphics[scale=0.4]{ref_7366847796_snapshot_intermediaire1499.png}
\end{center}
\caption{Solution à $t=5$jours, $10$ jours et $15$ jours, $N=31$, $CFL=0.9$}
\begin{com}
NOTA BENE : ICI $(\lambda_c, \theta_c)=(\pi/4, \pi/6)$ PAR COMODITE VISUELLE.
\end{com}
\label{Williamson 5 - visuel} 
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[scale=0.4]{ref_7366847796_conservation.png}\\
\end{center}
\caption{Conervation pour le test de la montagne isolée, $N=31$, $CFL=0.9$}
\begin{com}
NOTA BENE : ICI $(\lambda_c, \theta_c)=(\pi/4, \pi/6)$ PAR COMODITE VISUELLE ET L'INTEGRATION EST DISCUTABLE.
\end{com}
\label{Williamson 5 - conservation}
\end{figure}

\section{Solution stationnaire perturbée}

Le test de \cite{Galewsky2004}