% testSWEC.tex
\chapter{Benchmarks sur l'équation SWEC}

\section{Forme de SWEC}

On a montré dans le Chapitre 1 que l'équation Shallow Water était issue de l'équation de Navier-Stokes en tenant compte d'une faible profondeur de fluide et de la faible viscosité.

L'équation Shallow Water obtenue était la suivante :

\begin{equation}
\label{eq:SWEC_new}
\left\lbrace
\begin{array}{rcl}
\dfrac{\partial \mathbf{u}}{\partial t} + \left( \mathbf{u} \cdot \nabla \right) \mathbf{u} + f \mathbf{k} \wedge \mathbf{u} + g \nabla h & = & \mathbf{0} \\
\dfrac{\partial h^{\star}}{\partial t} + \nabla \cdot \left( h^{\star} \mathbf{u} \right) & = & 0
\end{array}
\right.
\end{equation}

avec $h^{\star} = h - h_s$, $\eta_s$ représentant les reliefs sur la sphère. On suppose $h_s$ indépendant du temps $t$.

Il peut être délicat de travailler avec le terme $\left( \mathbf{u} \cdot \nabla \right) \mathbf{u}$. Pour éviter de discrétiser directement ce terme, on se repose sur la formule suivante :

\begin{equation}
\left( \mathbf{u} \cdot \nabla \right) \mathbf{u} = \nabla \left( \dfrac{1}{2} \mathbf{u}^2 \right) + \zeta \mathbf{k} \wedge \mathbf{u}
\end{equation}

avec $\zeta = \mathbf{k} \cdot \left( \nabla \wedge \mathbf{u} \right)$ la vorticité relative. On note la présence de $\nabla \wedge \mathbf{u}$ le rotationnel de $\mathbf{u}$.

L'équation \eqref{eq:SWEC_new} s'écrit alors :

\begin{equation}
\label{eq:SWEC_vectform}
\left\lbrace
\begin{array}{rcl}
\dfrac{\partial \mathbf{u}}{\partial t} + \nabla \left( g h + \dfrac{1}{2} \mathbf{u}^2  \right) + \left( \zeta + f \right) \mathbf{k} \wedge \mathbf{u} & = & \mathbf{0} \\
\dfrac{\partial h^{\star}}{\partial t} + \nabla \cdot \left( h^{\star} \mathbf{u} \right) & = & 0
\end{array}
\right.
\end{equation}

Dans la suite, nous travaillerons avec cette forme de l'équation \eqref{eq:SWEC_new}.


\section{Relations de Conservations}

L'équation \eqref{eq:SWEC_vectform} vérifie certaines relations de conservations au sens continu.

\begin{proposition}
Les relations de conservations suivantes sont vérifiées si $(\mathbf{u},h)$ est solution de \eqref{eq:SWEC_vectform} :
\begin{itemize}
\item Conservation de la matière :
\begin{equation}
\dfrac{d}{dt} \gint_{\mathbb{S}_a^2} h^{\star} = 0
\label{eq:mass}
\end{equation}
 
\item Conservation de l'énergie :
\begin{equation}
\dfrac{d}{dt} \gint_{\mathbb{S}_a^2} \dfrac{1}{2} h^{\star} \mathbf{u}.^2 + \dfrac{1}{2} g \left( h^2 - h_s^2 \right) = 0
\label{eq:energy}
\end{equation}

\item Conservation de l'enstrophie potentielle :
\begin{equation}
\dfrac{d}{dt} \gint_{\mathbb{S}_a^2} \dfrac{\left( \zeta + f \right)^2}{h^{\star}} = 0
\label{eq:enstrophie}
\end{equation}

\item Conservation de la vorticité :
\begin{equation}
\dfrac{d}{dt} \gint_{\mathbb{S}_a^2} \zeta = 0
\label{eq:vorticity}
\end{equation}

\item Conservation de la divergence
\begin{equation}
\dfrac{d}{dt} \gint_{\mathbb{S}_a^2} \nabla \cdot \mathbf{u} = 0
\label{eq:divergence}
\end{equation}
\end{itemize}

avec $\zeta = \left( \nabla \wedge \mathbf{u} \right) \cdot \mathbf{k}$.
\end{proposition}

\begin{remarque}
Pour prouver que $\delta$ est conservée, il suffit de montrer qu'il existe $\mathbf{F} \mathbb{T} \mathbb{S}_a$ tel que :
$$
\dfrac{\partial \delta}{\partial t} = \nabla \cdot \mathbf{F}
$$
puis d'intégrer et de conclure avec la remarque \ref{remark_stokes}.
\label{rmq:int diverg nulle}
\end{remarque}

\begin{proof}
Pour la conservation de la masse \eqref{eq:mass} et de la divergence \eqref{eq:divergence}, le résultat est immédiat.

De plus, en posant $q = \dfrac{\zeta+f}{h^{\star}}$ et en appliquant à \eqref{eq:SWEC_vectform} l'opérateur de vorticité "$\mathbf{k} \cdot \left( \nabla \wedge \cdot \right)$", on obtient :

$$
\dfrac{\partial \zeta}{\partial t}+\nabla \wedge \left( q h^{\star} \mathbf{k} \wedge \mathbf{u} \right) \cdot\mathbf{k} + \underbrace{\nabla \wedge \nabla \left( gh + \dfrac{1}{2}\mathbf{u}^2 \right) \cdot \mathbf{k}}_{=0} = 0 
$$

Or on sait que pour tout $\mathbf{X}$ et $\mathbf{F}$, on a :
\begin{equation}
\nabla \cdot \left( \mathbf{X} \wedge \mathbf{F} \right) = - \left( \nabla \wedge \mathbf{F} \right) \cdot \mathbf{X}.
\end{equation}

donc :

$$
\dfrac{ \partial \zeta}{\partial t} + \nabla \cdot \left( q h^{\star} \mathbf{u} \right) = 0
$$

En utilisant la remarque \ref{rmq:int diverg nulle}, on en déduit la conservation de la vorticité \eqref{eq:vorticity}.

On note, que $f$ est indépendant du temps : $\dfrac{\partial q h^{\star}}{\partial t
} = \dfrac{\partial \zeta}{\partial t}$.

$$
\dfrac{\partial}{\partial t} \left( q h^{\star} \right) + \nabla \cdot \left( q h^{\star} \mathbf{u} \right) = 0
$$

et on a démontré la conservation de l'enstrophie potentielle \eqref{eq:enstrophie}.

En ce qui concerne la conservation de l'énergie, on pose :
\begin{equation}
\begin{array}{rcl}
E_1 & = & \dfrac{1}{2} h^{\star} \mathbf{u}^2 \\
E_2 & = & \dfrac{1}{2} g \left( h^2 - h_s^2 \right)
\end{array}
\end{equation}

par dérivation :
\begin{equation}
\begin{array}{rcl}
\dfrac{\partial}{\partial t} E_1 & = & -\dfrac{1}{2} \mathbf{u}^2 \nabla \cdot \left( h^{\star} \mathbf{u} \right) - h^{\star} \mathbf{u} \cdot \nabla \left( \dfrac{1}{2} \mathbf{u}^2 + gh \right) \\
\dfrac{\partial}{\partial t} E_2 & = & - gh \nabla \cdot \left( h^{\star} \mathbf{u} \right) - g h_s \dfrac{\partial h_s}{\partial t} 
\end{array}
\end{equation}

par somme :

$$
\dfrac{\partial E_1 + E_2}{\partial t} = - \nabla \cdot \left( \dfrac{1}{2} \mathbf{u}^2 + gh \right) - g h_s \dfrac{\partial h_s}{\partial t} 
$$

$h_s$ est indépendant du temps donc en appliquant la remarque \ref{rmq:int diverg nulle}, on obtient la conservation de l'énergie.
\end{proof}

\section{Solution stationnaire zonale}

Dans cette section, on cherche $(\mathbf{u},h)$ une solution stationnaire (indépendante de $t$) de \eqref{eq:SWEC_vectform} sans reliefs ($h_s \equiv 0$) avec $\mathbf{u}$ zonale autour de l'axe tourné d'un angle $\alpha$ (Voir Figure \ref{fig:rot alpha sphere}), c'est à dire $\mathbf{u}(\lambda', \theta') = u(\theta') \mathbf{e}_{\lambda'}$.

\begin{proposition}
Les solutions stationnaires zonales $(\mathbf{u},h)$ de \eqref{eq:SWEC_vectform} sont données par :
\begin{equation}
\left\lbrace
\begin{array}{rcl}
\mathbf{u}(\theta') & = & u(\theta') \mathbf{e}_{\lambda'}\\
h(\theta') & = & h_0 - \dfrac{a}{g} \gint^{\theta'} u(\tau) \left( u(\tau) \dfrac{\tan (\tau)}{a} + f \right) d\tau\\
\end{array}
\right.
\label{eq:sol. stationaire zonale de swe}
\end{equation}
avec $f \equiv f(\theta') = 2 \omega \sin \theta'$, $u$ une fonction de classe $\mathcal{C}^1$.
\end{proposition}

\begin{proof}
On utilise les expression du gradient et du rotationnel \eqref{divergence_lonlat} et \eqref{rotationnel_lonlat} sur la première équation de \eqref{eq:SWEC_vectform}. On a alors :
\begin{equation}
\zeta + f = u(\theta') \dfrac{\tan \theta'}{a} - \dfrac{1}{a} u'(\theta') + f.
\end{equation}
Ainsi :
\begin{equation}
\left( \zeta + f \right) \mathbf{k} \wedge \mathbf{u} = \left( u^2 (\theta') \dfrac{\tan \theta'}{a} - \dfrac{1}{a} u(\theta') u'(\theta') + f(\theta') u(\theta') \right) \mathbf{e}_{\theta'}
\end{equation}

De même, avec l'expression du gradient, on obtient :

\begin{equation}
\nabla \left( gh + \dfrac{1}{2} |\mathbf{u}|^2 \right) = \dfrac{g}{a \cos \theta'} \dfrac{\partial h}{\partial \lambda'} \mathbf{e}_{\lambda'} + \left[ \dfrac{g}{a} \dfrac{\partial h}{\partial \theta'} + \dfrac{1}{a} u'(\theta') u(\theta') \right] \mathbf{e}_{\theta'}
\end{equation}

Comme la solution recherchée est stationnaire, on a $h$ et $\mathbf{u}$ indépendants de $t$. D'où :

\begin{equation}
\left( \xi + f \right) \mathbf{k} \wedge \mathbf{u} + \nabla \left( gh + \dfrac{1}{2} |\mathbf{u}|^2 \right) = 0
\end{equation}

En traitant cette équation composante par composante, on peut en déduire des informations sur $h$.

\begin{itemize}
\item \textbf{Composante en} $\mathbf{e}_{\lambda'}$ : 

\begin{equation}
\dfrac{g}{a \cos \theta'} \dfrac{\partial h}{\partial \lambda'} = 0
\end{equation}

donc $h$ est indépendant de $\lambda'$.

\item \textbf{Composante en} $\mathbf{e}_{\theta'}$ :

\begin{equation}
u^2 (\theta') \dfrac{\tan \theta'}{a}  + f(\theta') u(\theta') + \dfrac{g}{a} h'(\theta') = 0
\end{equation}

d'où l'on déduit facilement :

\begin{equation}
h'(\theta') = - u(\theta') \dfrac{a}{g} \left( u(\theta') \dfrac{\tan \theta'}{a} + f(\theta') \right)
\end{equation}

que l'on intègre pour obtenir la formule de la proposition :

\begin{equation}
h(\theta') = h_0 - \dfrac{a}{g} \gint^{\theta'} u(\tau) \left( u(\tau) \dfrac{\tan (\tau)}{a} + f(\tau) \right) d\tau
\end{equation}

Enfin, comme $u$ et $h$ ne dépendent que de $\theta'$, il est facile de vérifier que $\nabla \cdot \left( h \mathbf{u} \right)=0$
\end{itemize}
\end{proof}

Ces solutions stationnaires zonales servent de base dans de nombreux test. En particulier dans le second test de \cite{Williamson1992} où il s'agit d'un cas particulier de cette proposition. Dans le test 5 du même article, il s'agit d'une perturbation de ce cas à l'aide d'un relief.
Le test de J. Galewsky \cite{Galewsky2004} est une perturbation d'une solution zonale stationnaire instable en perturbant la condition initiale.

\section{Test 2 de D. L. Williamson et al.}

Dans le second test de \cite{Williamson1992}, on considère une solution stationnaire zonale de la forme \eqref{eq:sol. stationaire zonale de swe} avec $\mathbf{u}(\theta')=u_0 \cos \theta' \mathbf{e}_{\lambda'}$. En utilisant l'équation \eqref{eq:u0*cos alpha}, on a le champ de vitesse $\mathbf{u}$ de la forme suivante :

\begin{equation}
\mathbf{u}(\lambda, \theta) = u_0 \left( \cos \theta \cos \alpha + \cos \lambda \sin \theta \sin \alpha \right) \mathbf{e}_{\lambda} - u_0 \sin \lambda \sin \alpha \mathbf{e}_{\theta}
\end{equation} 

et le paramètre de Coriolis $f$ est la fonction donnée grâce à la formule (\ref{coord_rot}.b) en considèrant $(\lambda_P, \theta_P) = (\pi, \pi/2 - \alpha)$ :

\begin{equation}
f (\lambda, \theta) = 2 \omega \sin \theta' = 2 \omega \left( - \cos \lambda \cos \theta \sin \alpha + \sin \theta \cos \alpha \right).
\end{equation}

La fonction $h$ est donnée par :

\begin{equation}
h(\lambda', \theta') = h_0 - \dfrac{a}{g} \gint^{\theta'} u_0 \cos \tau \left( u_0 \dfrac{\tan \tau}{a} + 2 \omega \sin \tau \right) d \tau
\end{equation}

après intégration, on obtient :

\begin{equation}
\begin{array}{rcl}
h(\lambda, \theta) & = & h_0 - \left( \dfrac{a}{g} \omega u_0 + \dfrac{u_0^2}{2} \right) \sin^2 \theta' \\
                   & = & h_0 - \left( \dfrac{a}{g} \omega u_0 + \dfrac{u_0^2}{2} \right) \left( - \cos \lambda \cos \theta \sin \alpha + \sin \theta \cos \alpha \right)^2
\end{array}
\end{equation}

L'idée est d'utiliser ces fonctions $h$ et $\mathbf{u}$ en donnée initiale avec différentes valeurs de $\alpha$ pour regarder si la solution stationnaire est conservée et avec quelle précision.

On observe l'erreur relative sur $h$ au temps $t^n$:

\begin{equation}
\dfrac{\| h(t^n) - h_{ex}\|_i}{\| h_ex \|_i}
\end{equation}

avec $h_ex(\lambda, \theta) = h_0 - \left( \dfrac{a}{g} \omega u_0 + \dfrac{u_0^2}{2} \right) \left( - \cos \lambda \cos \theta \sin \alpha + \sin \theta \cos \alpha \right)^2$ et $i \in \lbrace 1,2,\infty \rbrace$.

Ainsi que l'erreur relative sur le champs de vitesse $\mathbf{u}$ : 

\begin{equation}
\dfrac{\| \mathbf{u}(t^n) - \mathbf{u}_{ex}\|_{\infty}}{\| \mathbf{u}_ex \|_\infty}
\end{equation}

avec :

\begin{equation}
\mathbf{u}_{ex}(\lambda, \theta) = u_0 \left( \cos \theta \cos \alpha + \cos \lambda \sin \theta \sin \alpha \right) \mathbf{e}_{\lambda} - u_0 \sin \lambda \sin \alpha \mathbf{e}_{\theta}
\end{equation}

Le contrôle de la conservation de $q$ est donnée par :

\begin{equation}
\dfrac{|Q(q - q_{init})|}{|Q(q_{init})|}
\end{equation}

où $Q$ est la méthode de quadrature utilisée et $q_{init}$ la quantité à conserver au temps initial. En ce qui concerne la conservation de la divergence et de la vorticité, on doit avoir $Q(q_{init}=0$ donc on utilise la formule :

\begin{equation}
|Q(q - q_{init})|
\end{equation}

pour vérifier la conservation souhaitée. Les résultats sont donnés pour un maillage raisonnable ($N=32$)  Figures \ref{fig: williamson 2 space alpha=0} et \ref{fig: williamson 2 space alpha=pi/4} pour la représentation spatiale de l'erreur. Dans les Figures \ref{fig: williamson 2 conservation alpha=0} et \ref{fig: williamson 2 conservation alpha=pi/4}, on présente les résultats de conservation.

L'erreur au cours du temps est donnée Figure \ref{fig: williamson 2 erreur}

\begin{figure}
\begin{center}
\includegraphics[scale=0.5]{ref_7369088145_snapshot_intermediaire598.png}\\
\includegraphics[scale=0.5]{ref_7369088145_snapshot_err_color.png}
\end{center}
\caption{Test 2 de J. L. Williamson et al. \cite{Williamson1992} avec $\alpha=0$, $N=32$ et $CFL=0.9$. $h$ à $t=6$ jours et erreur relative sur $h$ au même temps.}
\label{fig: williamson 2 space alpha=0}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[scale=0.5]{ref_7369088145_conservationA.png}
\includegraphics[scale=0.5]{ref_7369088145_conservationB.png}
\end{center}
\caption{Test 2 de J. L. Williamson et al. \cite{Williamson1992} avec $\alpha=0$, $N=32$ et $CFL=0.9$ - Erreurs relative sur la conservation de la masse, l'énergie et l'enstrophie (gauche), erreur sur la conservation de la divergence et de la vorticité (droite).}
\label{fig: williamson 2 conservation alpha=0}
\end{figure}




\begin{figure}
\begin{center}
\includegraphics[scale=0.5]{ref_7369088270_snapshot_intermediaire598.png}\\
\includegraphics[scale=0.5]{ref_7369088270_snapshot_err_color.png}
\end{center}
\caption{Test 2 de J. L. Williamson et al. \cite{Williamson1992} avec $\alpha=\pi/4$, $N=32$ et $CFL=0.9$. $h$ à $t=6$ jours et erreur relative sur $h$ au même temps.}
\label{fig: williamson 2 space alpha=pi/4}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[scale=0.5]{ref_7369088270_conservationA.png}
\includegraphics[scale=0.5]{ref_7369088270_conservationB.png}
\end{center}
\caption{Test 2 de J. L. Williamson et al. \cite{Williamson1992} avec $\alpha=\pi/4$, $N=32$ et $CFL=0.9$ - Erreurs relative sur la conservation de la masse, l'énergie et l'enstrophie (gauche), erreur sur la conservation de la divergence et de la vorticité (droite).}
\label{fig: williamson 2 conservation alpha=pi/4}
\end{figure}




\begin{figure}
\begin{center}
\includegraphics[scale=0.5]{ref_7369088145_erreur.png}
\includegraphics[scale=0.5]{ref_7369088270_erreur.png}
\end{center}
\caption{Test 2 de J. L. Williamson et al. \cite{Williamson1992} avec $N=32$ et $CFL=0.9$ - erreur relative au cours du temps $\alpha = 0$ (gauche) et $\alpha = \pi/4$ (droite).}
\label{fig: williamson 2 erreur}
\end{figure}